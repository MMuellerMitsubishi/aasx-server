/*
 * DotAAS Part 2 | HTTP/REST | Entire API Collection
 *
 * The entire API collection as part of Details of the Asset Administration Shell Part 2
 *
 * OpenAPI spec version: V1.0RC03
 * 
 * Generated by: https://github.com/swagger-api/swagger-codegen.git
 */
using AasCore.Aas3_0_RC02;
using Microsoft.AspNetCore.Mvc.Formatters;
using Microsoft.Net.Http.Headers;
using System.Text.Json;
using System.Threading.Tasks;

namespace IO.Swagger.V1RC03
{
    public class AasCoreOutputFormatter : OutputFormatter
    {

        public AasCoreOutputFormatter()
        {
            this.SupportedMediaTypes.Clear();
            this.SupportedMediaTypes.Add(MediaTypeHeaderValue.Parse("application/json"));
        }

        public override bool CanWriteResult(OutputFormatterCanWriteContext context)
        {
            if (typeof(IClass).IsAssignableFrom(context.ObjectType))
            {
                return base.CanWriteResult(context);
            }
            else
                return false;
        }

        public override Task WriteResponseBodyAsync(OutputFormatterWriteContext context)
        {
            var response = context.HttpContext.Response;

            var json = AasCore.Aas3_0_RC02.Jsonization.Serialize.ToJsonObject((IClass)context.Object);

            var writer = new Utf8JsonWriter(response.Body);
            json.WriteTo(writer);
            writer.FlushAsync().GetAwaiter().GetResult();

            return Task.FromResult(response);
        }
    }
}